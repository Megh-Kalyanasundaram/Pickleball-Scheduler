<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Pickleball Tournament Scheduler</title>
<style>
  :root {
    --bg: #0b1e29;
    --card: #112a38;
    --gold: #d4af37;
    --gold-light: #e6c567;
    --text: #e8f4ff;
    --muted: #94a9b8;
    --border: rgba(212,175,55,0.15);
    --radius: 14px;
  }
  * { box-sizing: border-box; margin:0; padding:0; }
  body {
    min-height: 100dvh;
    background: var(--bg);
    color: var(--text);
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    line-height: 1.5;
    padding: env(safe-area-inset-top) 0;
  }
  .banner {
    position: fixed;
    top: 0; left: 0; right: 0;
    height: 56px;
    background: linear-gradient(180deg, #0a2633, #0e2f40);
    color: white;
    font-size: 21px;
    font-weight: 800;
    display: flex;
    align-items: center;
    padding: 0 20px;
    border-bottom: 3px solid var(--gold);
    z-index: 1000;
  }
  .wrap { margin: 76px 16px 30px; max-width: 1200px; margin-left:auto; margin-right:auto; }

  .card {
    background: var(--card);
    border-radius: var(--radius);
    padding: 20px;
    border: 1px solid var(--border);
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
  }
  .title {
    font-size: 22px;
    font-weight: 800;
    color: var(--gold-light);
    margin-bottom: 20px;
  }
  label {
    font-size: 14px;
    color: var(--muted);
    margin-bottom: 6px;
    display: block;
  }
  input, select {
    width: 100%;
    height: 48px !important;           /* uniform height */
    padding: 0 14px;
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 10px;
    color: var(--text);
    font-size: 16px;
  }
  select { appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath fill='%23d4af37' d='M1 1l5 5 5-5'/%3E%3C/svg%3E"); background-repeat:no-repeat; background-position: right 14px center; }

  .grid-2 {
    display: grid;
    gap: 16px;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  }
  .checkbox-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin: 16px 0;
    font-size: 15px;
  }
  .checkbox-row input[type=checkbox] { width:22px; height:22px; accent-color: var(--gold); }

  .actions {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin-top: 24px;
    align-items: center;
    justify-content: space-between;
  }
  .btn {
    height: 48px;
    padding: 0 24px;
    border-radius: 12px;
    font-weight: 700;
    font-size: 16px;
    cursor: pointer;
    border: none;
  }
  .btn-primary { background: var(--gold); color: #0b1e2a; }
  .btn-ghost { background: transparent; border: 1px solid rgba(255,255,255,0.15); color: var(--text); }
  .warning { color: #ff6b6b; font-weight: 600; font-size: 15px; }

  .modal-overlay {
    position: fixed; inset: 0;
    background: rgba(0,0,0,0.75);
    display: flex; align-items: center; justify-content: center;
    z-index: 9999;
    padding: 20px;
  }
  .modal {
    background: var(--card);
    border-radius: var(--radius);
    width: 100%; max-width: 560px;
    padding: 24px;
    border: 1px solid var(--border);
    max-height: 90dvh; overflow-y: auto;
  }
</style>
</head>
<body>

<div class="banner">Current Stage: Round Robin</div>

<div class="wrap">
  <div class="card">
    <div class="title">Setup</div>

    <div class="grid-2">
      <div>
        <label>Game Type</label>
        <select id="gameType"><option value="doubles" selected>Doubles</option><option value="singles">Singles</option></select>
      </div>
      <div>
        <label>No. of Teams</label>
        <input id="numTeams" type="number" min="2" value="8">
      </div>
      <div>
        <label>No. of Courts</label>
        <input id="numCourts" type="number" min="1" value="2">
      </div>
      <div>
        <label>No. of Groups</label>
        <input id="numGroups" type="number" min="1" value="2">
      </div>
      <div>
        <label>Round-Robin Type</label>
        <select id="rrType">
          <option value="within" selected>Within Groups</option>
          <option value="across">Across Clubs</option>
          <option value="all">Across All</option>
        </select>
      </div>
      <div>
        <label>Court allocation</label>
        <select id="courtAllocation">
          <option value="sequential">Sequential Balanced</option>
          <option value="roundwise">Round-wise</option>
        </select>
      </div>
      <div>
        <label>Qualifiers/group</label>
        <select id="qualPerGroup"><option>1</option><option selected>2</option><option>4</option><option>8</option></select>
      </div>
    </div>

    <div class="checkbox-row">
      <input type="checkbox" id="enableQF"><label for="enableQF">Enable Quarter-Finals (when ≥8 qualifiers)</label>
    </div>
    <div class="checkbox-row">
      <input type="checkbox" id="enableDUPR"><label for="enableDUPR">Enable DUPR IDs</label>
    </div>

    <div class="actions">
      <div>
        <button class="btn btn-primary" id="startEntryBtn">Next: Enter Details</button>
        <button class="btn btn-ghost" id="resetBtn" style="margin-left:12px;">Reset All</button>
      </div>
      <div style="display:flex;gap:12px;align-items:center;">
        <button class="btn btn-primary" id="manageClubsBtn" style="display:none;">Manage Clubs First</button>
        <span id="manageClubsWarning" class="warning" style="display:none;">Please click “Manage Clubs First” first</span>
      </div>
    </div>
  </div>

  <div id="entryCard" class="card" style="margin-top:20px;display:none;">
    <div class="title">Enter Teams & Players</div>
    <div id="entryInner"></div>
  </div>
</div>

<div id="modalRoot"></div>

<script>
let hasOpenedManageClubs = false;

const $ = id => document.getElementById(id);
const CLUBS_KEY = 'pickle_clubs_v1';

function readClubs() { try { return JSON.parse(localStorage.getItem(CLUBS_KEY) || '[]') } catch { return [] } }
function writeClubs(arr) { localStorage.setItem(CLUBS_KEY, JSON.stringify(arr || [])); }
function toast(msg) { alert(msg); }

function openManageClubs() {
  hasOpenedManageClubs = true;
  $('manageClubsWarning').style.display = 'none';

  const overlay = document.createElement('div'); overlay.className = 'modal-overlay';
  const modal = document.createElement('div'); modal.className = 'modal';
  modal.innerHTML = `
    <h2 style="margin:0 0 16px;color:var(--gold-light);">Manage Clubs</h2>
    <div id="clubList" style="max-height:50vh;overflow-y:auto;margin-bottom:16px;"></div>
    <div style="display:flex;gap:8px;">
      <input id="newClub" placeholder="New club name" style="flex:1;height:48px;padding:0 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.04);color:white;">
      <button class="btn btn-primary" id="addClubBtn">Add</button>
    </div>
    <div style="text-align:right;margin-top:16px;">
      <button class="btn btn-ghost" id="doneBtn">Done</button>
    </div>
  `;
  overlay.appendChild(modal);
  $('modalRoot').appendChild(overlay);

  function render() {
    const list = modal.querySelector('#clubList');
    const clubs = readClubs();
    list.innerHTML = clubs.length ? '' : '<p style="color:var(--muted);text-align:center;">No clubs yet</p>';
    clubs.forEach(c => {
      const div = document.createElement('div');
      div.style.cssText = 'display:flex;justify-content:space-between;align-items:center;padding:12px;background:rgba(255,255,255,0.05);border-radius:8px;margin:6px 0;';
      div.innerHTML = `<span>${c.name}</span><button class="btn btn-ghost btn-small" data-id="${c.id}">Delete</button>`;
      list.appendChild(div);
    });
    modal.querySelectorAll('[data-id]').forEach(b => b.onclick = () => {
      if (confirm('Delete club?')) { writeClubs(clubs.filter(x => x.id !== b.dataset.id)); render(); }
    });
  }
  render();

  modal.querySelector('#addClubBtn').onclick = () => {
    const name = modal.querySelector('#newClub').value.trim();
    if (!name) return toast('Enter club name');
    const clubs = readClubs();
    clubs.push({id: 'c_' + Date.now(), name});
    writeClubs(clubs);
    modal.querySelector('#newClub').value = '';
    render();
    populateClubSelects();
  };
  overlay.onclick = e => { if (e.target === overlay) overlay.remove(); };
  modal.querySelector('#doneBtn').onclick = () => overlay.remove();
}

function populateClubSelects() {
  const clubs = readClubs();
  document.querySelectorAll('select[id^="team_club_"]').forEach(sel => {
    const cur = sel.value;
    sel.innerHTML = '<option value="">-- Select Club --</option>';
    clubs.forEach(c => sel.add(new Option(c.name, c.id)));
    if (cur) sel.value = cur;
  });
}

function startEntry() {
  const rrType = $('rrType').value;

  if (rrType === 'across' && !hasOpenedManageClubs) {
    $('manageClubsWarning').style.display = 'block';
    toast('Across Clubs selected — please click “Manage Clubs First” before continuing.');
    return;
  }

  if (rrType === 'across' && readClubs().length === 0) {
    toast('No clubs defined. Adding at least one club is required.');
    openManageClubs();
    return;
  }

  $('manageClubsWarning').style.display = 'none';

  // Build entry form (kept simple but beautiful)
  const n = Math.max(2, +$('numTeams').value || 8);
  const isDoubles = $('gameType').value === 'doubles';
  const dupr = $('enableDUPR').checked;
  let html = '';

  for (let i = 1; i <= n; i++) {
    html += `
      <div style="background:rgba(255,255,255,0.05);padding:16px;border-radius:12px;margin-bottom:16px;">
        <div style="font-weight:700;margin-bottom:12px;color:var(--gold-light);">Team ${i}</div>
        <input placeholder="Player A" id="pA_${i}">
        ${isDoubles ? `<input placeholder="Player B" id="pB_${i}" style="margin-top:10px;">` : ''}
        ${dupr ? `<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px;">
          <input placeholder="DUPR A" id="dA_${i}"><input placeholder="DUPR B" id="dB_${i}">
        </div>` : ''}
        ${rrType === 'across' ? `<div style="margin-top:12px;">
          <select id="team_club_${i}"><option value="">-- Select Club --</option></select>
        </div>` : ''}
      </div>`;
  }

  html += `<div style="display:flex;gap:12px;justify-content:flex-end;">
    <button class="btn btn-primary" id="saveTeams">Save Teams</button>
    <button class="btn btn-ghost" id="cancelEntry">Cancel</button>
  </div>`;

  $('entryInner').innerHTML = html;
  $('entryCard').style.display = 'block';
  if (rrType === 'across') populateClubSelects();

  $('saveTeams').onclick = () => { toast('Teams saved – ready for fixtures!'); $('entryCard').style.display = 'none'; };
  $('cancelEntry').onclick = () => $('entryCard').style.display = 'none';
}

/* UI wiring */
$('startEntryBtn').onclick = startEntry;
$('manageClubsBtn').onclick = openManageClubs;

$('rrType').onchange = () => {
  const show = $('rrType').value === 'across';
  $('manageClubsBtn').style.display = show ? 'inline-flex' : 'none';
  $('manageClubsWarning').style.display = 'none';
  if (!show) hasOpenedManageClubs = false;
};

$('resetBtn').onclick = () => confirm('Reset everything?') && location.reload();
</script>
</body>
</html>
