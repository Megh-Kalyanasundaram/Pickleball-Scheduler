<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Pickleball Tournament Scheduler</title>
<meta name="description" content="A compact, mobile-friendly web app to create fixtures, record scores, and generate live rankings and knockouts for pickleball tournaments â€” no spreadsheets needed."/>
<style>
Â  :root{
Â  Â  --page-bg:#f5f6f7;
Â  Â  --card-bg:#0f2435;
Â  Â  --gold:#d4af37;
Â  Â  --gold-hover:#e5c157;
Â  Â  --muted:#9aa6b4;
Â  Â  --card-text:#e7f3ff;
Â  Â  --white:#ffffff;
Â  Â  --radius:8px;
Â  Â  --maxwidth:1200px;
Â  Â  --shadow:0 6px 18px rgba(2,8,25,0.12);
Â  }

Â  html,body{height:100%;margin:0;font-family:Inter,Segoe UI,Arial,sans-serif;background:var(--page-bg);color:#102238;-webkit-font-smoothing:antialiased;}
Â  /* short banner */
Â  .banner{position:fixed;top:0;left:0;right:0;height:30px;display:flex;align-items:center;padding:0 12px;background:var(--card-bg);color:var(--card-text);box-shadow:0 4px 14px rgba(2,6,23,0.2);z-index:999;font-weight:700;font-size:13px;}
Â  /* reduced top spacing so content moves up */
Â  .wrap{max-width:var(--maxwidth);margin:40px auto 18px;padding:8px;}
Â  header{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;}
Â  .subtitle{color:var(--muted);font-size:12px;margin-top:2px;}

Â  /* two-column layout */
Â  .grid{display:grid;grid-template-columns:1fr 340px;gap:12px;}
Â  @media (max-width:980px){ .grid{grid-template-columns:1fr;} }

Â  .card{background:var(--card-bg);color:var(--card-text);border-radius:var(--radius);padding:10px;box-shadow:var(--shadow);}
Â  .title{font-weight:700;color:#eaf4ff;margin:0 0 6px;font-size:14px;}
Â  .muted{color:var(--muted);font-size:12px;}

Â  label{display:block;font-size:12px;color:var(--muted);margin-bottom:4px;}
Â  input[type="text"], input[type="number"], select {
Â  Â  width:100%; box-sizing:border-box; padding:8px; border-radius:8px; border:1px solid rgba(255,255,255,0.04);
Â  Â  background: rgba(255,255,255,0.02); color:var(--card-text); font-size:13px;
Â  Â  /* BEGIN UI ENHANCEMENT: General select visibility/styling (Point 4) */
Â  Â  -webkit-appearance: none; /* remove default arrow/styling */
Â  Â  -moz-appearance: none;
Â  Â  appearance: none;
Â  Â  background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="rgba(231, 243, 255, 0.6)" d="M7 10l5 5 5-5z"/></svg>');
Â  Â  background-repeat: no-repeat;
Â  Â  background-position: right 8px top 50%;
Â  Â  background-size: 16px 16px;
Â  }

Â  /* UI ENHANCEMENT: Round-Robin Type font size (Point 3) */
Â  .rr-select {
Â  Â  font-size: 12px !important; 
Â  }

Â  /* UI ENHANCEMENT: Ensure option text is visible regardless of selection (Point 4) */
Â  select option {
Â  Â  color: #102238; /* ensures dark text on a white background when drop-down is opened */
Â  Â  background: var(--white); /* ensures background is white when drop-down is opened */
Â  }

Â  .btn { background:var(--gold); color:#102238; border:none; padding:8px 10px; font-weight:700; border-radius:8px; cursor:pointer; box-shadow:0 6px 12px rgba(20,18,16,0.06); font-size:13px; }
Â  .btn:hover{ background:var(--gold-hover); }
Â  .btn.ghost { background:transparent; color:var(--card-text); border:1px solid rgba(255,255,255,0.04); padding:7px 9px; }
Â  .btn.small { padding:6px 8px; font-size:12px; }
Â  .btn.block { display:block; width:100%; }

Â  .setup-row{ display:grid; grid-template-columns: repeat(7, minmax(90px, 1fr)); gap:8px; }
Â  @media (max-width:1200px){ .setup-row{ grid-template-columns: repeat(5, minmax(90px, 1fr)); } }
Â  @media (max-width:1024px){ .setup-row{ grid-template-columns: repeat(4, minmax(90px, 1fr)); } }
Â  @media (max-width:720px){ .setup-row{ grid-template-columns: repeat(2, 1fr); } }
Â  @media (max-width:420px){ .setup-row{ grid-template-columns: 1fr; } }

Â  .action-row { display:flex; gap:8px; justify-content:flex-end; flex-wrap:wrap; margin-top:8px; }
Â  @media (max-width:420px){ .action-row{ flex-direction:column; } .action-row .btn{ width:100%; } }

Â  .match-grid{ display:grid; grid-template-columns: repeat(auto-fill,minmax(300px,1fr)); gap:10px; margin-top:10px; }
Â  @media (max-width:600px){ .match-grid{ grid-template-columns:1fr; } }

Â  .match-card{ background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:8px; padding:10px; border:1px solid rgba(255,255,255,0.04); color:var(--card-text); }
Â  .match-title{ font-weight:700; color:#eaf4ff; margin-bottom:6px; font-size:13px; }
Â  .team-label { font-size:13px; color:#eaf4ff; font-weight:600; }
Â  .team-players { font-size:12px; color:var(--muted); margin-bottom:6px; }

Â  .score-input{ width:72px; padding:7px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); background: rgba(255,255,255,0.02); color:var(--card-text); text-align:center; font-size:13px; min-width:60px; }

Â  .white-table { width:100%; border-collapse:collapse; background:var(--white); color:#102238; border-radius:8px; overflow:hidden; margin-top:10px; }
Â  .white-table th, .white-table td { padding:8px; border-bottom:1px solid #e6eaee; text-align:left; font-size:12px; }
Â  .white-table thead th { background:#f1f5f8; color:#667085; font-weight:700; }

Â  /* compact for phones */
Â  @media (max-width:420px){
Â  Â  .wrap{ margin-top:36px; padding:8px; }
Â  Â  .card{ padding:8px; border-radius:6px; }
Â  Â  label{font-size:11px;}
Â  Â  .banner{height:28px;font-size:12px;}
Â  }

Â  /* hide banner in print for a cleaner PDF */
Â  @media print{ .banner{display:none;} }
</style>
</head>
<body>
Â  <div class="banner" id="stageBanner">Current Stage: Round Robin</div>

Â  <div class="wrap">
Â  Â  <header>
Â  Â  Â  Â  Â  Â  <div></div>
Â  Â  </header>

Â  Â  <div class="grid">
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card">
Â  Â  Â  Â  Â  <div class="title">Setup</div>
Â  Â  Â  Â  Â  <div class="setup-row">
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <label>Game Type</label>
Â  Â  Â  Â  Â  Â  Â  <select id="gameType" onchange="onGameTypeChange()">
Â  Â  Â  Â  Â  Â  Â  Â  <option value="doubles" selected>Doubles</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="singles">Singles</option>
Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <label id="numLabel">No. of Teams</label>
Â  Â  Â  Â  Â  Â  Â  <input id="numTeams" type="number" min="2" value="6" oninput="updateQualifierDefaults()">
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <label>No. of Courts</label>
Â  Â  Â  Â  Â  Â  Â  <input id="numCourts" type="number" min="1" value="2">
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <label>No. of Groups</label>
Â  Â  Â  Â  Â  Â  Â  <input id="numGroups" type="number" min="1" value="1" oninput="updateQualifierDefaults()">
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <label>Round-Robin Type</label>
Â  Â  Â  Â  Â  Â  Â  <select id="rrType" class="rr-select">
Â  Â  Â  Â  Â  Â  Â  Â  <option value="within" selected>Within Groups</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="across">Across All</option>
Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <label>Qualifiers/group</label>
Â  Â  Â  Â  Â  Â  Â  <select id="qualPerGroup" onchange="onQualPerGroupManual()">
Â  Â  Â  Â  Â  Â  Â  Â  <option value="1">1</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="2">2</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="4">4</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="8">8</option>
Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <label><input id="enableQF" type="checkbox"> Enable QF</label>
Â  Â  Â  Â  Â  Â  Â  <div class="muted" style="font-size:11px;" id="qfHelp">QF will only run when total qualifiers â‰¥ 8 (and QF enabled).</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <div class="action-row">
Â  Â  Â  Â  Â  Â  <button class="btn" id="startEntryBtn">Next: Enter Details</button>
Â  Â  Â  Â  Â  Â  <button class="btn ghost" id="resetBtn">Reset All</button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div id="entryCard" class="card" style="margin-top:12px; display:none;">
Â  Â  Â  Â  Â  <div class="title" id="entryTitle">Enter Teams & Players</div>
Â  Â  Â  Â  Â  <div id="entryInner"></div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div id="summaryCard" class="card" style="margin-top:12px; display:none;">
Â  Â  Â  Â  Â  <div class="title">Group Summary</div>
Â  Â  Â  Â  Â  <div id="summaryInner"></div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div id="fixturesCard" class="card" style="margin-top:12px; display:none;">
Â  Â  Â  Â  Â  <div class="title">Fixtures â€” Enter Scores</div>
Â  Â  Â  Â  Â  <div id="fixturesGrid" class="match-grid"></div>

Â  Â  Â  Â  Â  <div class="action-row">
Â  Â  Â  Â  Â  Â  <button class="btn" id="genRRBtn">Generate Round-Robin Rankings</button>
Â  Â  Â  Â  Â  Â  <button class="btn ghost" id="backToSummaryBtn">Back</button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="muted" style="margin-top:8px;">Enter both team scores for a match to count. No ties allowed.</div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div id="rankingsCard" class="card" style="margin-top:12px; display:none;">
Â  Â  Â  Â  Â  <div class="title">ğŸ† Round-Robin Rankings</div>
Â  Â  Â  Â  Â  <div id="rankingsInner"></div>

Â  Â  Â  Â  Â  <div class="action-row" style="margin-top:10px;">
Â  Â  Â  Â  Â  Â  <button class="btn" id="proceedKO">Proceed to Knockouts</button>
Â  Â  Â  Â  Â  Â  <button class="btn ghost" id="exportCSVBtn">Export Rankings (CSV)</button>
Â  Â  Â  Â  Â  Â  <button class="btn ghost" id="printBtn">Print / Save as PDF</button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div id="knockoutsCard" class="card" style="margin-top:12px; display:none;">
Â  Â  Â  Â  Â  <div class="title">Knockout Stage</div>
Â  Â  Â  Â  Â  <div id="knockoutsInner"></div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  <div class="card">
Â  Â  Â  Â  Â  <div class="title">Quick Actions</div>
Â  Â  Â  Â  Â  <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px;">
Â  Â  Â  Â  Â  Â  <button class="btn small" id="quickGenFixtures">Generate Fixtures</button>
Â  Â  Â  Â  Â  Â  <button class="btn small" id="quickGenRanks">Generate Round-Robin Rankings</button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="card" style="margin-top:12px;">
Â  Â  Â  Â  Â  <div class="title">Notes</div>
Â  Â  Â  Â  Â  <div class="muted" style="margin-top:6px;">
Â  Â  Â  Â  Â  Â  â€¢ Round-robin totals exclude knockout matches.<br>
Â  Â  Â  Â  Â  Â  â€¢ If total qualifiers = 4 â†’ Semifinals (1v4,2v3).<br>
Â  Â  Â  Â  Â  Â  â€¢ If total qualifiers â‰¥ 8 and QF enabled â†’ Quarterfinals (top 8 seeded).<br>
Â  Â  Â  Â  Â  Â  â€¢ Enter both scores for a match to count; ties are not allowed.
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <footer style="margin-top:12px;font-size:12px;color:var(--muted);">Prompt-designed by Megh Kalyanasundaram</footer>
Â  </div>

<script>
/* ---------- App State ---------- */
let teams = [];Â  Â  Â  Â  // {id,name,players[],group}
let fixtures = [];Â  Â  Â // {id,matchNum,court,group,t1,t2}
let rankings = {};Â  Â  Â // groupKey -> [stat objects]
let knockout = {};Â  Â  Â // { qf:[{id,a,b}], sf1, sf2, final, third }

/* ---------- Helpers ---------- */
const $ = id => document.getElementById(id);
function updateBanner(stage){ $('stageBanner').textContent = `Current Stage: ${stage}`; }
updateBanner('Round Robin');

function clampInt(v, min) { const n=Number(v); return Number.isNaN(n) ? min : Math.max(min, Math.floor(n)); }

/* ---------- Qualifier defaults logic ---------- */
function updateQualifierDefaults(){
Â  const numTeams = clampInt($('numTeams').value, 0);
Â  const numGroups = clampInt($('numGroups').value, 1);
Â  const qualSelect = $('qualPerGroup');

Â  // Only set default if user hasn't manually changed recently.
Â  // We'll set default based on rules:
Â  // - 1 group, 4-7 teams => 4 qualifiers
Â  // - 1 group, >=8 teams => 8 qualifiers
Â  // - >=2 groups => 2 qualifiers (default)
Â  if (numGroups === 1) {
Â  Â  if (numTeams >= 8) qualSelect.value = '8';
Â  Â  else if (numTeams >= 4) qualSelect.value = '4';
Â  Â  else if (numTeams >= 2) qualSelect.value = '2';
Â  Â  else qualSelect.value = '1';
Â  } else {
Â  Â  qualSelect.value = '2';
Â  }

Â  // enable/disable QF checkbox info
Â  const totalQuals = Number(qualSelect.value) * numGroups;
Â  if (totalQuals >= 8) $('enableQF').disabled = false;
Â  else { $('enableQF').disabled = true; $('enableQF').checked = false; }
}

function onQualPerGroupManual(){
Â  // If user manually sets qualifiers, we respect it and update QF enabled accordingly
Â  const numGroups = clampInt($('numGroups').value, 1);
Â  const totalQuals = Number($('qualPerGroup').value) * numGroups;
Â  $('enableQF').disabled = !(totalQuals >= 8);
Â  if ($('enableQF').disabled) $('enableQF').checked = false;
}

/* ---------- Entry flow ---------- */
function onGameTypeChange(){
Â  const type = $('gameType').value;
Â  $('numLabel').textContent = (type === 'singles') ? 'No. of Players' : 'No. of Teams';
Â  $('entryTitle').textContent = (type === 'singles') ? 'Enter Players' : 'Enter Teams & Players';
}

function startEntry(){
Â  const n = clampInt($('numTeams').value, 0);
Â  if (n < 2) { alert('Please enter at least 2 participants.'); return; }
Â  const type = $('gameType').value;
Â  let html = '';
Â  for (let i=1;i<=n;i++){
Â  Â  html += `<div style="margin-bottom:8px; background:rgba(255,255,255,0.02); padding:8px; border-radius:8px;">`;
Â  Â  if (type === 'singles'){
Â  Â  Â  html += `<label style="font-size:12px;color:var(--muted)">Player ${i} (optional)</label><input id="pA_${i}" type="text" placeholder="Player name">`;
Â  Â  } else {
Â  Â  Â  html += `<label style="font-size:12px;color:var(--muted)">Team ${i} â€” Players (optional)</label>
Â  Â  Â  Â  <div style="display:flex;gap:8px;margin-top:6px;"><input id="pA_${i}" type="text" placeholder="Player A" style="flex:1"><input id="pB_${i}" type="text" placeholder="Player B" style="flex:1"></div>`;
Â  Â  }
Â  Â  html += `</div>`;
Â  }
Â  html += `<div style="display:flex;justify-content:flex-end;gap:8px;"><button class="btn" id="saveTeamsBtn">Save</button><button class="btn ghost" id="cancelEntryBtn">Cancel</button></div>`;
Â  $('entryInner').innerHTML = html;
Â  $('entryCard').style.display = 'block';
Â  $('fixturesCard').style.display = 'none';
Â  $('rankingsCard').style.display = 'none';
Â  $('knockoutsCard').style.display = 'none';
Â  updateBanner('Entry');

Â  // bind dynamic buttons
Â  $('saveTeamsBtn').onclick = saveTeams;
Â  $('cancelEntryBtn').onclick = cancelEntry;
}

function cancelEntry(){ $('entryInner').innerHTML=''; $('entryCard').style.display='none'; updateBanner('Round Robin'); }

function saveTeams(){
Â  const n = clampInt($('numTeams').value, 0);
Â  const type = $('gameType').value;
Â  teams = [];
Â  for (let i=1;i<=n;i++){
Â  Â  const v1 = ($(`pA_${i}`)?.value || '').trim();
Â  Â  const v2 = ($(`pB_${i}`)?.value || '').trim();
Â  Â  const defaultName = (type === 'singles') ? `Player ${i}` : `Team ${i}`;
Â  Â  const players = (type === 'singles') ? (v1 ? [v1] : []) : [v1, v2].filter(Boolean);
Â  Â  const name = (players.length > 0 && type === 'singles') ? players[0] : defaultName;
Â  Â  teams.push({ id:i, name, players, group:null });
Â  }
Â  assignGroups();
}

/* ---------- Groups ---------- */
function assignGroups(){
Â  const numGroups = Math.max(1, Number($('numGroups').value) || 1);
Â  teams.forEach((t, idx) => t.group = (idx % numGroups) + 1);
Â  showGroupSummary();
}

function showGroupSummary(){
Â  if (!teams || teams.length === 0) return alert('No participants defined.');
Â  const numGroups = Math.max(1, Number($('numGroups').value) || 1);
Â  const groups = Array.from({length:numGroups}, ()=>[]);
Â  teams.forEach(t=> groups[t.group-1].push(t));
Â  let html = '<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:8px;">';
Â  groups.forEach((g,i)=>{
Â  Â  html += `<div style="background:var(--white);color:#102238;padding:8px;border-radius:8px;"><div style="font-weight:700;margin-bottom:6px;">Group ${i+1} â€” ${g.length} entries</div><table class="white-table"><thead><tr><th>Name</th><th>Players</th></tr></thead><tbody>`;
Â  Â  if (g.length===0) html += `<tr><td colspan="2" class="muted">No entries</td></tr>`;
Â  Â  else g.forEach(t => html += `<tr><td>${t.name}</td><td>${(t.players||[]).join(' & ')}</td></tr>`);
Â  Â  html += '</tbody></table></div>';
Â  });
Â  html += '</div>';
Â  html += `<div style="display:flex;justify-content:flex-end;gap:8px;margin-top:8px;"><button class="btn" id="genFixturesBtn">Generate Fixtures</button><button class="btn ghost" id="editEntryBtn">Edit</button></div>`;
Â  $('summaryInner').innerHTML = html;
Â  $('summaryCard').style.display = 'block';
Â  $('entryCard').style.display = 'none';
Â  $('knockoutsCard').style.display = 'none';
Â  updateBanner('Group Summary');

Â  $('genFixturesBtn').onclick = generateFixtures;
Â  $('editEntryBtn').onclick = startEntry;
}

/* ---------- Fixtures ---------- */
function generateFixtures(){
Â  if (!teams || teams.length < 2) return alert('Please add participants first.');
Â  const numCourts = Math.max(1, Number($('numCourts').value) || 1);
Â  const rrType = $('rrType').value;
Â  const numGroups = Math.max(1, Number($('numGroups').value) || 1);
Â  teams.forEach((t,idx) => { if (!t.group) t.group = (idx % numGroups) + 1; });

Â  let rawFixtures = [];
Â  if (rrType === 'across'){
Â  Â  rawFixtures = roundRobin(teams, 'all');
Â  } else {
Â  Â  const groups = {};
Â  Â  teams.forEach(t => { if (!groups[t.group]) groups[t.group] = []; groups[t.group].push(t); });
Â  Â  Object.keys(groups).sort((a,b)=>a-b).forEach(gk => rawFixtures = rawFixtures.concat(roundRobin(groups[gk], Number(gk))));
Â  }

Â  fixtures = rawFixtures.map((f, idx) => ({
Â  Â  id: idx,
Â  Â  matchNum: idx+1,
Â  Â  court: (idx % numCourts) + 1,
Â  Â  group: f.group,
Â  Â  t1: f.t1,
Â  Â  t2: f.t2
Â  }));

Â  renderFixtures();
}

function roundRobin(list, groupKey){
Â  const arr = [...list];
Â  if (arr.length % 2 !== 0) arr.push({ id:null, name:'BYE', players:[] });
Â  const n = arr.length;
Â  const rounds = n-1;
Â  let order = arr.slice();
Â  const out = [];
Â  for (let r=0;r<rounds;r++){
Â  Â  for (let i=0;i<n/2;i++){
Â  Â  Â  const a = order[i], b = order[n-1-i];
Â  Â  Â  if (a.name !== 'BYE' && b.name !== 'BYE') out.push({ group: groupKey, t1: a, t2: b });
Â  Â  }
Â  Â  order.splice(1,0,order.pop());
Â  }
Â  return out;
}

function renderFixtures(){
Â  const grid = $('fixturesGrid'); grid.innerHTML = '';
Â  fixtures.forEach(m=>{
Â  Â  const card = document.createElement('div'); card.className='match-card';
Â  Â  const groupLabel = (m.group === 'all' ? 'All' : m.group);
Â  Â  card.innerHTML = `
Â  Â  Â  <div class="match-title">Match ${m.matchNum} â€¢ Court ${m.court} â€¢ Group ${groupLabel}</div>
Â  Â  Â  <div style="display:flex;align-items:center;justify-content:space-between;">
Â  Â  Â  Â  <div class="team-label">${m.t1.name}</div>
Â  Â  Â  Â  <div style="margin-left:12px"><input id="s1-${m.id}" class="score-input" type="number" min="0" placeholder="Score"></div>
Â  Â  Â  </div>
Â  Â  Â  <div style="height:8px"></div>
Â  Â  Â  <div style="display:flex;align-items:center;justify-content:space-between;">
Â  Â  Â  Â  <div class="team-label">${m.t2.name}</div>
Â  Â  Â  Â  <div style="margin-left:12px"><input id="s2-${m.id}" class="score-input" type="number" min="0" placeholder="Score"></div>
Â  Â  Â  </div>
Â  Â  `;
Â  Â  grid.appendChild(card);
Â  });

Â  $('fixturesCard').style.display = 'block';
Â  $('rankingsCard').style.display = 'none';
Â  $('knockoutsCard').style.display = 'none';
Â  updateBanner('Round Robin â€” Enter Scores');
}

/* ---------- Rankings (Round-Robin only) ---------- */
function generateRoundRobinRankings(){
Â  if (!fixtures || fixtures.length === 0) return alert('No fixtures. Generate fixtures first.');

Â  // initialize stats
Â  const stats = {};
Â  teams.forEach(t => stats[t.id] = { id:t.id, name:t.name, players:t.players, group:t.group, matchesWon:0, ptsWon:0, ptsLost:0, diff:0 });

Â  // iterate fixtures; only count matches where both scores entered and not knockout
Â  for (const m of fixtures){
Â  Â  const s1El = $(`s1-${m.id}`), s2El = $(`s2-${m.id}`);
Â  Â  if (!s1El || !s2El) continue;
Â  Â  const s1 = s1El.value === '' ? NaN : Number(s1El.value);
Â  Â  const s2 = s2El.value === '' ? NaN : Number(s2El.value);
Â  Â  if (Number.isNaN(s1) && Number.isNaN(s2)) continue; // not played
Â  Â  if (Number.isNaN(s1) || Number.isNaN(s2)) return alert(`Match ${m.matchNum}: both scores required.`);
Â  Â  if (s1 === s2) return alert(`Match ${m.matchNum}: tie detected (${s1}). Ties are not allowed.`);

Â  Â  const winnerId = s1 > s2 ? m.t1.id : m.t2.id;
Â  Â  const loserId = s1 > s2 ? m.t2.id : m.t1.id;
Â  Â  const winnerScore = Math.max(s1, s2), loserScore = Math.min(s1, s2);

Â  Â  if (stats[winnerId]) { stats[winnerId].matchesWon += 1; stats[winnerId].ptsWon += winnerScore; stats[winnerId].ptsLost += loserScore; }
Â  Â  if (stats[loserId])Â  { stats[loserId].ptsWon += loserScore; stats[loserId].ptsLost += winnerScore; }
Â  }

Â  // group mapping based on rrType
Â  const rrType = $('rrType').value;
Â  const groupsMap = {};
Â  if (rrType === 'across') {
Â  Â  groupsMap['all'] = Object.values(stats);
Â  } else {
Â  Â  Object.values(stats).forEach(s => {
Â  Â  Â  const g = s.group || 1;
Â  Â  Â  if (!groupsMap[g]) groupsMap[g] = [];
Â  Â  Â  groupsMap[g].push(s);
Â  Â  });
Â  }

Â  // compute diff and sort
Â  rankings = {};
Â  Object.keys(groupsMap).sort((a,b)=> (a==='all'? -1 : Number(a)-Number(b)) ).forEach(k=>{
Â  Â  const arr = groupsMap[k];
Â  Â  arr.forEach(x=> x.diff = (x.ptsWon||0) - (x.ptsLost||0));
Â  Â  arr.sort((a,b)=>{
Â  Â  Â  if ((b.matchesWon||0) !== (a.matchesWon||0)) return (b.matchesWon||0) - (a.matchesWon||0);
Â  Â  Â  return (b.diff||0) - (a.diff||0);
Â  Â  });
Â  Â  arr.forEach((s,i)=> s.rank = i+1);
Â  Â  rankings[k] = arr;
Â  });

Â  renderRankings();
Â  updateBanner('Round-Robin Rankings');
}

function renderRankings(){
Â  const wrap = $('rankingsInner'); let html = '<div style="display:grid;gap:10px;">';
Â  Object.keys(rankings).forEach(key=>{
Â  Â  const arr = rankings[key];
Â  Â  const title = (key === 'all') ? 'Overall Ranking (Across All)' : `Group ${key} Ranking`;
Â  Â  html += `<div style="background:var(--white);color:#102238;padding:8px;border-radius:8px;"><div style="font-weight:700;margin-bottom:6px;">${title}</div>`;
Â  Â  html += `<div class="table-wrap"><table class="white-table"><thead><tr><th>Rank</th><th>Name</th><th>Players</th><th>Won</th><th>Pts Won</th><th>Pts Lost</th><th>Diff</th></tr></thead><tbody>`;
Â  Â  arr.forEach(r => {
Â  Â  Â  html += `<tr><td>${r.rank}</td><td>${r.name}</td><td>${(r.players||[]).join(' & ')}</td><td>${r.matchesWon||0}</td><td>${r.ptsWon||0}</td><td>${r.ptsLost||0}</td><td>${r.diff||0}</td></tr>`;
Â  Â  });
Â  Â  html += `</tbody></table></div></div>`;
Â  });
Â  html += '</div>';
Â  wrap.innerHTML = html;
Â  $('rankingsCard').style.display = 'block';
}

/* ---------- Determine qualifiers ---------- */
function getQualifiedList(){
Â  // qualifiers per group times num groups, but we must pick top N from each group or overall depending on rrType
Â  const per = Math.max(1, Number($('qualPerGroup').value) || 1);
Â  const rrType = $('rrType').value;
Â  const numGroups = Math.max(1, Number($('numGroups').value) || 1);
Â  const qualified = [];

Â  if (rrType === 'across'){
Â  Â  const all = rankings['all'] || [];
Â  Â  const totalWanted = per * numGroups;
Â  Â  for (let i=0;i<Math.min(all.length, totalWanted); i++) qualified.push(all[i]);
Â  } else {
Â  Â  const groupKeys = Object.keys(rankings).filter(k=>k!=='all').sort((a,b)=>Number(a)-Number(b));
Â  Â  groupKeys.forEach(k=>{
Â  Â  Â  const arr = rankings[k] || [];
Â  Â  Â  for (let i=0;i<Math.min(arr.length, per); i++) qualified.push(arr[i]);
Â  Â  });
Â  }
Â  return qualified;
}

/* ---------- PROCEED to Knockouts logic (Option A implemented) ---------- */
function proceedToKnockouts(){
Â  if (!rankings || Object.keys(rankings).length === 0) return alert('Generate Round-Robin Rankings first.');

Â  const qualified = getQualifiedList();
Â  if (qualified.length < 2) return alert('Not enough qualifiers.');

Â  // Determine flow based on total qualifiers and QF setting
Â  const totalQuals = qualified.length;
Â  const qfEnabled = $('enableQF').checked;

Â  if (totalQuals >= 8 && qfEnabled){
Â  Â  // Quarterfinals using top 8
Â  Â  prepareQuarterfinals(qualified);
Â  } else if (totalQuals >= 4){
Â  Â  // Direct to Semifinals (Option A)
Â  Â  prepareSemifinalsDirect(qualified);
Â  } else if (totalQuals === 2){
Â  Â  // Direct Final (rare) â€” we will treat as semifinal-byes: directly create final
Â  Â  prepareDirectFinal(qualified);
Â  } else {
Â  Â  return alert('Insufficient qualifiers for knockouts (need at least 4 to run semifinals or 8 for quarterfinals).');
Â  }
}

/* ---------- Quarterfinals (only when totalQuals >=8 and QF enabled) ---------- */
function prepareQuarterfinals(qualifiedList){
Â  // use top 8
Â  const prepared = qualifiedList.slice(0,8);
Â  // seed: 1v8,4v5,2v7,3v6 mapping to QF1..QF4
Â  const top8 = prepared;
Â  const qfPairs = [
Â  Â  { id:'QF1', a: top8[0], b: top8[7] },
Â  Â  { id:'QF2', a: top8[3], b: top8[4] },
Â  Â  { id:'QF3', a: top8[1], b: top8[6] },
Â  Â  { id:'QF4', a: top8[2], b: top8[5] }
Â  ];
Â  knockout = { qf: qfPairs, sf1:null, sf2:null, final:null, third:null };
Â  renderQuarterfinals();
Â  updateBanner('Quarterfinals');
}

function renderQuarterfinals(){
Â  const inner = $('knockoutsInner'); inner.innerHTML = '';
Â  knockout.qf.forEach((m,idx)=>{
Â  Â  const div = document.createElement('div'); div.style.marginBottom='8px';
Â  Â  const aLabel = m.a.isBye ? 'BYE' : `${m.a.name}`;
Â  Â  const bLabel = m.b.isBye ? 'BYE' : `${m.b.name}`;
Â  Â  div.innerHTML = `<div class="match-card" style="padding:10px;">
Â  Â  Â  <div style="font-weight:700;color:#eaf4ff;margin-bottom:6px;">Quarterfinal ${idx+1}</div>
Â  Â  Â  <div style="display:flex;align-items:center;justify-content:space-between;"><div class="team-label">${aLabel}</div><input id="${m.id}-s1" class="score-input" type="number" min="0" placeholder="Score"></div>
Â  Â  Â  <div style="height:8px"></div>
Â  Â  Â  <div style="display:flex;align-items:center;justify-content:space-between;"><div class="team-label">${bLabel}</div><input id="${m.id}-s2" class="score-input" type="number" min="0" placeholder="Score"></div>
Â  Â  </div>`;
Â  Â  inner.appendChild(div.firstChild);
Â  });

Â  const row = document.createElement('div'); row.style.display='flex'; row.style.justifyContent='flex-end'; row.style.marginTop='8px';
Â  const btn = document.createElement('button'); btn.className='btn'; btn.textContent='Proceed to Semifinals';
Â  btn.onclick = processQuarterfinals;
Â  row.appendChild(btn);
Â  inner.appendChild(row);

Â  $('knockoutsCard').style.display = 'block';
}

/* process QF winners, advance to SF */
function processQuarterfinals(){
Â  if (!knockout || !knockout.qf) return alert('Quarterfinals not configured.');
Â  const winners = [];
Â  for (const m of knockout.qf){
Â  Â  const s1El = $(`${m.id}-s1`), s2El = $(`${m.id}-s2`);
Â  Â  if (!s1El || !s2El) return alert(`${m.id}: score fields missing.`);
Â  Â  const v1 = s1El.value === '' ? NaN : Number(s1El.value);
Â  Â  const v2 = s2El.value === '' ? NaN : Number(s2El.value);
Â  Â  if (Number.isNaN(v1) || Number.isNaN(v2)) return alert(`${m.id}: enter both scores.`);
Â  Â  if (v1 === v2) return alert(`${m.id}: ties not allowed.`);
Â  Â  winners.push( v1 > v2 ? m.a : m.b );
Â  }

Â  // SF1: winner(QF1) vs winner(QF4), SF2: winner(QF2) vs winner(QF3)
Â  knockout.sf1 = { id:'SF1', name:'Semifinal 1', a: winners[0], b: winners[3] };
Â  knockout.sf2 = { id:'SF2', name:'Semifinal 2', a: winners[1], b: winners[2] };
Â  knockout.qf = null;
Â  renderSemifinals();
Â  updateBanner('Semifinals');
}

/* ---------- Semifinals direct when total qualifiers = 4 (Option A) ---------- */
function prepareSemifinalsDirect(qualifiedList){
Â  // qualifiedList expected in selection order (group-wise/top lists)
Â  // If 4 or more qualifiers present, take top 4 and seed SF: 1v4, 2v3
Â  const top = qualifiedList.slice(0,4);
Â  knockout = {
Â  Â  qf: null,
Â  Â  sf1: { id:'SF1', name:'Semifinal 1', a: top[0], b: top[3] },
Â  Â  sf2: { id:'SF2', name:'Semifinal 2', a: top[1], b: top[2] },
Â  Â  final: null,
Â  Â  third: null
Â  };
Â  renderSemifinals();
Â  updateBanner('Semifinals');
}

function renderSemifinals(){
Â  const inner = $('knockoutsInner'); inner.innerHTML = '';
Â  [knockout.sf1, knockout.sf2].forEach(match=>{
Â  Â  const div = document.createElement('div'); div.style.marginBottom='8px';
Â  Â  const aLabel = match.a.isBye ? 'BYE' : `${match.a.name}`;
Â  Â  const bLabel = match.b.isBye ? 'BYE' : `${match.b.name}`;
Â  Â  div.innerHTML = `<div class="match-card" style="padding:10px;">
Â  Â  Â  <div style="font-weight:700;color:#eaf4ff;margin-bottom:6px;">${match.name}</div>
Â  Â  Â  <div style="display:flex;align-items:center;justify-content:space-between;"><div class="team-label">${aLabel}</div><input id="${match.id}-s1" class="score-input" type="number" min="0" placeholder="Score"></div>
Â  Â  Â  <div style="height:8px"></div>
Â  Â  Â  <div style="display:flex;align-items:center;justify-content:space-between;"><div class="team-label">${bLabel}</div><input id="${match.id}-s2" class="score-input" type="number" min="0" placeholder="Score"></div>
Â  Â  </div>`;
Â  Â  inner.appendChild(div.firstChild);
Â  });

Â  const row = document.createElement('div'); row.style.display='flex'; row.style.justifyContent='flex-end'; row.style.marginTop='8px';
Â  const btn = document.createElement('button'); btn.className='btn'; btn.textContent='Proceed to Final & 3rd Place';
Â  btn.onclick = processSemifinals;
Â  row.appendChild(btn);
Â  inner.appendChild(row);

Â  $('knockoutsCard').style.display = 'block';
}

/* process semis -> finalists and 3rd place matches */
function processSemifinals(){
Â  const matches = [knockout.sf1, knockout.sf2];
Â  const winners = [], losers = [];
Â  for (const m of matches){
Â  Â  const s1El = $(`${m.id}-s1`), s2El = $(`${m.id}-s2`);
Â  Â  if (!s1El || !s2El) return alert(`${m.id}: score fields missing.`);
Â  Â  const v1 = s1El.value === '' ? NaN : Number(s1El.value);
Â  Â  const v2 = s2El.value === '' ? NaN : Number(s2El.value);
Â  Â  if (Number.isNaN(v1) || Number.isNaN(v2)) return alert(`${m.id}: enter both scores.`);
Â  Â  if (v1 === v2) return alert(`${m.id}: ties not allowed.`);
Â  Â  if (v1 > v2) { winners.push(m.a); losers.push(m.b); } else { winners.push(m.b); losers.push(m.a); }
Â  }

Â  knockout.final = { id:'FINAL', name:'Final', a: winners[0], b: winners[1] };
Â  knockout.thirdÂ  = { id:'THIRD', name:'3rd Place', a: losers[0], b: losers[1] };
Â  renderFinals();
Â  updateBanner('Finals & 3rd Place');
}

/* ---------- Direct final (2 qualifiers) ---------- */
function prepareDirectFinal(qualified){
Â  // qualified is length 2
Â  const a = qualified[0], b = qualified[1];
Â  knockout = { qf:null, sf1:null, sf2:null, final: { id:'FINAL', name:'Final', a, b }, third: null };
Â  renderFinals();
Â  updateBanner('Final');
}

/* ---------- Render Final & 3rd ---------- */
function renderFinals(){
Â  const inner = $('knockoutsInner'); inner.innerHTML = '';

Â  if (knockout.final){
Â  Â  const f = knockout.final;
Â  Â  const divF = document.createElement('div'); divF.style.marginBottom='8px';
Â  Â  const aLabel = f.a.isBye ? 'BYE' : `${f.a.name}`;
Â  Â  const bLabel = f.b.isBye ? 'BYE' : `${f.b.name}`;
Â  Â  divF.innerHTML = `<div class="match-card" style="padding:10px;">
Â  Â  Â  <div style="font-weight:700;color:#eaf4ff;margin-bottom:6px;">Final</div>
Â  Â  Â  <div style="display:flex;align-items:center;justify-content:space-between;"><div class="team-label">${aLabel}</div><input id="FINAL-s1" class="score-input" type="number" min="0" placeholder="Score"></div>
Â  Â  Â  <div style="height:8px"></div>
Â  Â  Â  <div style="display:flex;align-items:center;justify-content:space-between;"><div class="team-label">${bLabel}</div><input id="FINAL-s2" class="score-input" type="number" min="0" placeholder="Score"></div>
Â  Â  </div>`;
Â  Â  inner.appendChild(divF.firstChild);
Â  }

Â  if (knockout.third){
Â  Â  const t = knockout.third;
Â  Â  const divT = document.createElement('div'); divT.style.marginBottom='8px';
Â  Â  const aLabel = t.a.isBye ? 'BYE' : `${t.a.name}`;
Â  Â  const bLabel = t.b.isBye ? 'BYE' : `${t.b.name}`;
Â  Â  divT.innerHTML = `<div class="match-card" style="padding:10px;">
Â  Â  Â  <div style="font-weight:700;color:#eaf4ff;margin-bottom:6px;">3rd Place</div>
Â  Â  Â  <div style="display:flex;align-items:center;justify-content:space-between;"><div class="team-label">${aLabel}</div><input id="THIRD-s1" class="score-input" type="number" min="0" placeholder="Score"></div>
Â  Â  Â  <div style="height:8px"></div>
Â  Â  Â  <div style="display:flex;align-items:center;justify-content:space-between;"><div class="team-label">${bLabel}</div><input id="THIRD-s2" class="score-input" type="number" min="0" placeholder="Score"></div>
Â  Â  </div>`;
Â  Â  inner.appendChild(divT.firstChild);
Â  }

Â  const doneRow = document.createElement('div'); doneRow.style.display='flex'; doneRow.style.justifyContent='flex-end'; doneRow.style.marginTop='8px';
Â  const doneBtn = document.createElement('button'); doneBtn.className='btn'; doneBtn.textContent='Finalize Knockouts';
Â  doneBtn.onclick = finalizeKnockouts;
Â  doneRow.appendChild(doneBtn);
Â  inner.appendChild(doneRow);

Â  $('knockoutsCard').style.display = 'block';
}

/* ---------- Finalize knockouts (validate & show winners) ---------- */
function finalizeKnockouts(){
Â  // validate final
Â  if (knockout.final){
Â  Â  const f1 = $('FINAL-s1'), f2 = $('FINAL-s2');
Â  Â  if (!f1 || !f2) return alert('Enter final scores.');
Â  Â  const v1 = f1.value === '' ? NaN : Number(f1.value);
Â  Â  const v2 = f2.value === '' ? NaN : Number(f2.value);
Â  Â  if (Number.isNaN(v1) || Number.isNaN(v2)) return alert('Enter both final scores.');
Â  Â  if (v1 === v2) return alert('Final: tie not allowed.');
Â  Â  const finalWinner = v1 > v2 ? knockout.final.a : knockout.final.b;
Â  Â  const finalRunnerÂ  = v1 > v2 ? knockout.final.b : knockout.final.a;
Â  Â  // third place (optional)
Â  Â  let thirdWinner = null, thirdRunner = null;
Â  Â  if (knockout.third){
Â  Â  Â  const t1 = $('THIRD-s1'), t2 = $('THIRD-s2');
Â  Â  Â  if (!t1 || !t2) return alert('Enter 3rd place scores.');
Â  Â  Â  const tv1 = t1.value === '' ? NaN : Number(t1.value);
Â  Â  Â  const tv2 = t2.value === '' ? NaN : Number(t2.value);
Â  Â  Â  if (Number.isNaN(tv1) || Number.isNaN(tv2)) return alert('Enter both 3rd place scores.');
Â  Â  Â  if (tv1 === tv2) return alert('3rd place: tie not allowed.');
Â  Â  Â  thirdWinner = tv1 > tv2 ? knockout.third.a : knockout.third.b;
Â  Â  Â  thirdRunner = tv1 > tv2 ? knockout.third.b : knockout.third.a;
Â  Â  }
Â  Â  let msg = `Winner: ${finalWinner.isBye ? 'BYE' : finalWinner.name}\nRunner-up: ${finalRunner.isBye ? 'BYE' : finalRunner.name}`;
Â  Â  if (thirdWinner) msg += `\n3rd Place: ${thirdWinner.name}\n4th Place: ${thirdRunner.name}`;
Â  Â  alert(msg);
Â  Â  updateBanner('Tournament Complete');
Â  } else {
Â  Â  alert('No final configured.');
Â  }
}

/* ---------- Export CSV for rankings ---------- */
function exportRankingsCSV(){
Â  if (!rankings || Object.keys(rankings).length === 0) return alert('No rankings to export.');
Â  const rows=[['Group','Rank','ID','Name','Players','MatchesWon','PtsWon','PtsLost','Diff']];
Â  Object.keys(rankings).forEach(g=>{
Â  Â  (rankings[g]||[]).forEach(r=>{
Â  Â  Â  rows.push([g,String(r.rank||''),String(r.id||''),String(r.name||'').replace(/"/g,'""'),String((r.players||[]).join(' & ')).replace(/"/g,'""'),String(r.matchesWon||0),String(r.ptsWon||0),String(r.ptsLost||0),String(r.diff||0)]);
Â  Â  });
Â  });
Â  const csv = rows.map(r => r.map(c => `"${c}"`).join(',')).join('\n');
Â  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
Â  const url = URL.createObjectURL(blob);
Â  const a = document.createElement('a');
Â  a.href = url; a.download = 'rankings.csv'; document.body.appendChild(a);
Â  a.click(); setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 1000);
}

/* ---------- Reset All ---------- */
function resetAll(){
Â  if (!confirm('Reset all tournament data and UI?')) return;
Â  teams = []; fixtures = []; rankings = {}; knockout = {};
Â  // UI reset
Â  $('entryInner').innerHTML=''; $('entryCard').style.display='none';
Â  $('summaryInner').innerHTML=''; $('summaryCard').style.display='none';
Â  $('fixturesGrid').innerHTML=''; $('fixturesCard').style.display='none';
Â  $('rankingsInner').innerHTML=''; $('rankingsCard').style.display='none';
Â  $('knockoutsInner').innerHTML=''; $('knockoutsCard').style.display='none';
Â  // reset form values to defaults
Â  $('gameType').value='doubles';
Â  $('numTeams').value=6;
Â  $('numCourts').value=2;
Â  $('numGroups').value=1;
Â  updateQualifierDefaults();
Â  $('enableQF').checked=false;
Â  $('rrType').value='within';
Â  updateBanner('Round Robin');
}

/* ---------- Bind UI ---------- */
function bindUI(){
Â  $('startEntryBtn').onclick = startEntry;
Â  $('resetBtn').onclick = resetAll;
Â  $('genRRBtn').onclick = generateRoundRobinRankings;
Â  $('backToSummaryBtn').onclick = showGroupSummary; // Add back button functionality
Â  $('quickGenFixtures').onclick = generateFixtures;
Â  $('quickGenRanks').onclick = generateRoundRobinRankings;
Â  $('proceedKO').onclick = proceedToKnockouts;
Â  $('exportCSVBtn').onclick = exportRankingsCSV;
Â  $('printBtn').onclick = ()=> window.print();
Â  // dynamic qualifier defaulting
Â  $('numTeams').addEventListener('input', updateQualifierDefaults);
Â  $('numGroups').addEventListener('input', updateQualifierDefaults);
Â  $('qualPerGroup').addEventListener('change', onQualPerGroupManual);
}

/* ---------- Initial setup ---------- */
(function init(){
Â  onGameTypeChange();
Â  updateQualifierDefaults();
Â  bindUI();
})();
</script>
</body>
</html>